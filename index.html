<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Harga Jual E-Commerce</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0ea5e9">
    <meta name="description" content="Kalkulator harga jual optimal untuk e-commerce TikTok Shop dan Shopee dengan breakdown biaya lengkap">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Kalkulator E-Commerce">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                        },
                        gray: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Kalkulator Harga Jual E-Commerce</h1>
            <p class="text-gray-600">Hitung harga jual optimal dengan fee platform dan keuntungan yang diinginkan</p>
        </div>

        <!-- Main Calculator Card -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <!-- Platform Selection -->
            <div class="border-b border-gray-200 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Platform E-Commerce</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="relative">
                                                 <select id="platform" onchange="updatePlatformFees()" 
                                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white text-gray-900"
                                 aria-label="Pilih platform e-commerce">
                            <option value="tiktok">TikTok Shop</option>
                            <option value="shopee">Shopee</option>
                        </select>
                    </div>
                                         <div id="platformFees" class="bg-gray-50 rounded-lg p-4">
                         <h3 id="platformTitle" class="text-sm font-medium text-gray-900 mb-2">Fee TikTok Shop</h3>
                         <div id="feeDetails" class="text-sm text-gray-600">
                             <div class="flex justify-between items-center mb-2">
                                 <span>Dynamic Fee:</span>
                                 <div class="flex items-center space-x-2">
                                     <input type="number" id="tiktokDynamicFee" value="5.5" min="0" step="0.1" 
                                            class="w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                                     <span class="text-xs text-gray-500">%</span>
                                 </div>
                             </div>
                             <div class="flex justify-between items-center mb-2">
                                 <span>TikTok Fee:</span>
                                 <div class="flex items-center space-x-2">
                                     <input type="number" id="tiktokPlatformFee" value="8.0" min="0" step="0.1" 
                                            class="w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                                     <span class="text-xs text-gray-500">%</span>
                                 </div>
                             </div>
                             <div class="flex justify-between items-center mb-2">
                                 <span>Biaya Proses:</span>
                                 <div class="flex items-center space-x-2">
                                     <input type="number" id="tiktokProcessFee" value="1250" min="0" step="100" 
                                            class="w-20 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                                     <span class="text-xs text-gray-500">Rp</span>
                                 </div>
                             </div>
                             <div class="flex justify-between pt-2 border-t border-gray-200">
                                 <span class="font-medium">Total Fee:</span>
                                 <span id="tiktokTotalFee" class="font-bold text-primary-600">≈ 13,5% + Rp 1.250</span>
                             </div>
                         </div>
                         
                         <!-- TikTok Additional Fees -->
                         <div id="tiktokAdditionalFees" class="mt-4 pt-4 border-t border-gray-200 hidden">
                             <h4 class="text-xs font-medium text-gray-700 mb-2">Biaya Tambahan (Opsional)</h4>
                             <div class="space-y-2">
                                 <div class="flex items-center space-x-2">
                                     <input type="checkbox" id="komisiKategori" class="w-3 h-3 text-primary-600 border-gray-300 rounded focus:ring-primary-500">
                                     <label for="komisiKategori" class="text-xs text-gray-600">Komisi Kategori (4%)</label>
                                 </div>
                                 <div class="flex items-center space-x-2">
                                     <input type="checkbox" id="programVoucher" class="w-3 h-3 text-primary-600 border-gray-300 rounded focus:ring-primary-500">
                                     <label for="programVoucher" class="text-xs text-gray-600">Program Voucher Extra (4%)</label>
                                 </div>
                             </div>
                         </div>
                         
                         <!-- Platform Additional Fee Input -->
                         <div id="platformAdditionalFee" class="mt-4 pt-4 border-t border-gray-200">
                             <h4 class="text-xs font-medium text-gray-700 mb-2">Biaya Tambahan Platform (%)</h4>
                             <input type="number" id="platformAdditionalFeeInput" placeholder="Contoh: 2" min="0" step="0.1" value="0"
                                    class="w-full px-3 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white">
                         </div>
                     </div>
                </div>
            </div>

            <!-- Input Form -->
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left Column - Inputs -->
                    <div class="space-y-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">Data Produk</h2>
                        
                        <div>
                            <label for="modalPrice" class="block text-sm font-medium text-gray-700 mb-2">
                                Harga Modal (Rp)
                            </label>
                            <input type="number" id="modalPrice" placeholder="Contoh: 50000" min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white">
                        </div>

                        <div>
                            <label for="affiliateFee" class="block text-sm font-medium text-gray-700 mb-2">
                                Biaya Affiliate (%)
                            </label>
                            <input type="number" id="affiliateFee" placeholder="Contoh: 10" min="0" step="0.1" value="10"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white">
                        </div>

                        <div>
                            <label for="additionalCost" class="block text-sm font-medium text-gray-700 mb-2">
                                Biaya Tambahan (%)
                            </label>
                            <input type="number" id="additionalCost" placeholder="Contoh: 5" min="0" step="0.1" value="10"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white">
                        </div>

                        <div>
                            <label for="profit" class="block text-sm font-medium text-gray-700 mb-2">
                                Keuntungan (%)
                            </label>
                            <input type="number" id="profit" placeholder="Contoh: 20" min="0" step="0.1" value="20"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white">
                        </div>
                    </div>

                    <!-- Right Column - Method Selection -->
                    <div class="space-y-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">Metode Perhitungan</h2>
                        
                        <div class="bg-gray-50 rounded-lg p-6">
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3">
                                    <input type="radio" id="markup" name="method" value="markup" checked
                                           class="w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500">
                                    <label for="markup" class="text-sm font-medium text-gray-900">Markup</label>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <input type="radio" id="margin" name="method" value="margin"
                                           class="w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500">
                                    <label for="margin" class="text-sm font-medium text-gray-900">Margin</label>
                                </div>
                            </div>
                            
                            <div class="mt-4 p-4 bg-white rounded-lg border border-gray-200">
                                <p class="text-xs text-gray-600 mb-2">
                                    <span class="font-medium">Markup:</span> Keuntungan dihitung dari harga modal
                                </p>
                                <p class="text-xs text-gray-600">
                                    <span class="font-medium">Margin:</span> Keuntungan dihitung dari harga jual
                                </p>
                            </div>
                            
                            <!-- Detail Rumus Perhitungan -->
                            <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <h4 class="text-xs font-medium text-blue-900 mb-3">Detail Rumus Perhitungan</h4>
                                <div id="formulaDetails" class="text-xs text-blue-800 space-y-2">
                                    <div>
                                        <span class="font-medium">Total Modal:</span> Harga Modal + (Harga Modal × Biaya Tambahan %)
                                    </div>
                                    <div>
                                        <span class="font-medium">Markup:</span> Harga Jual = (Total Modal + Keuntungan + Biaya Proses) ÷ (1 - Total Fee %)
                                    </div>
                                    <div>
                                        <span class="font-medium">Margin:</span> Harga Jual = (Total Modal + Biaya Proses) ÷ (1 - Total Fee % - Keuntungan %)
                                    </div>
                                    <div>
                                        <span class="font-medium">Keuntungan Bersih:</span> Yang Diterima - Total Modal
                                    </div>
                                </div>
                                
                                <div class="mt-3 pt-3 border-t border-blue-200">
                                    <h5 class="text-xs font-medium text-blue-900 mb-2">Penjelasan Detail:</h5>
                                    <div class="text-xs text-blue-800 space-y-1">
                                        <div><span class="font-medium">• Biaya Tambahan:</span> Biaya operasional, packaging, dll yang ditambahkan ke modal</div>
                                        <div><span class="font-medium">• Markup:</span> Keuntungan dihitung dari total modal (modal + biaya tambahan)</div>
                                        <div><span class="font-medium">• Margin:</span> Keuntungan dihitung dari harga jual akhir</div>
                                        <div><span class="font-medium">• Total Fee:</span> Semua biaya platform (Dynamic Fee + TikTok Fee + Affiliate + dll)</div>
                                        <div><span class="font-medium">• Biaya Proses:</span> Biaya tetap per transaksi (Rp 1.250)</div>
                                        <div><span class="font-medium">• Yang Diterima:</span> Harga jual dikurangi semua fee platform</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calculate Button -->
                <div class="mt-8">
                    <button onclick="calculatePrice()" 
                            class="w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-4 px-6 rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                        Hitung Harga Jual
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="mt-8 bg-white rounded-lg shadow-sm border border-gray-200 p-6 hidden">
            <h2 class="text-lg font-semibold text-gray-900 mb-6 text-center">Hasil Perhitungan</h2>
            <div id="breakdown" class="space-y-4"></div>
        </div>
    </div>

    <script>
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(number);
        }

        function updatePlatformFees() {
            const platform = document.getElementById('platform').value;
            const platformTitle = document.getElementById('platformTitle');
            const feeDetails = document.getElementById('feeDetails');
            const tiktokAdditionalFees = document.getElementById('tiktokAdditionalFees');
            
            // Add event listeners for fee inputs after they are created
            setTimeout(() => {
                addFeeInputListeners();
            }, 100);
            
            if (platform === 'tiktok') {
                platformTitle.textContent = 'Fee TikTok Shop';
                feeDetails.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span>Dynamic Fee:</span>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="tiktokDynamicFee" value="5.5" min="0" step="0.1" 
                                   class="w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span>TikTok Fee:</span>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="tiktokPlatformFee" value="8.0" min="0" step="0.1" 
                                   class="w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span>Biaya Proses:</span>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="tiktokProcessFee" value="1250" min="0" step="100" 
                                   class="w-20 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                            <span class="text-xs text-gray-500">Rp</span>
                        </div>
                    </div>
                    <div class="flex justify-between pt-2 border-t border-gray-200">
                        <span class="font-medium">Total Fee:</span>
                        <span id="tiktokTotalFee" class="font-bold text-primary-600">≈ 13,5% + Rp 1.250</span>
                    </div>
                `;
                tiktokAdditionalFees.classList.remove('hidden');
                        } else if (platform === 'shopee') {
                platformTitle.textContent = 'Fee Shopee';
                feeDetails.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span>Biaya Lainnya:</span>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="shopeeBiayaLainnya" value="8" min="0" step="0.1" 
                                   class="w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span>Biaya Layanan:</span>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="shopeeBiayaLayanan" value="7" min="0" step="0.1" 
                                   class="w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                            <span class="text-xs text-gray-500">%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span>Biaya Proses:</span>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="shopeeBiayaProses" value="1250" min="0" step="100" 
                                   class="w-20 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 bg-white">
                            <span class="text-xs text-gray-500">Rp</span>
                        </div>
                    </div>
                    <div class="flex justify-between pt-2 border-t border-gray-200">
                        <span class="font-medium">Total Fee:</span>
                        <span id="shopeeTotalFee" class="font-bold text-primary-600">15% + Rp 1.250</span>
                    </div>
                `;
                tiktokAdditionalFees.classList.add('hidden');
                document.getElementById('platformAdditionalFee').classList.remove('hidden');
            }
        }

        function calculatePrice() {
            const platform = document.getElementById('platform').value;
            const modalPrice = parseFloat(document.getElementById('modalPrice').value) || 0;
            const affiliateFee = parseFloat(document.getElementById('affiliateFee').value) || 0;
            const additionalCost = parseFloat(document.getElementById('additionalCost').value) || 0;
            const profit = parseFloat(document.getElementById('profit').value) || 0;
            const method = document.querySelector('input[name="method"]:checked').value;
            
                         // TikTok additional fees
             const komisiKategori = document.getElementById('komisiKategori').checked ? 4 : 0;
             const programVoucher = document.getElementById('programVoucher').checked ? 4 : 0;
             
             // Platform additional fee
             const platformAdditionalFee = parseFloat(document.getElementById('platformAdditionalFeeInput').value) || 0;

            if (modalPrice <= 0) {
                alert('Mohon masukkan harga modal yang valid!');
                return;
            }

            let results = {};
            
            const additionalCostAmount = modalPrice * (additionalCost / 100);
            const totalModalCost = modalPrice + additionalCostAmount;
            
            if (platform === 'tiktok') {
                // Get editable fee values
                const dynamicFeeRate = parseFloat(document.getElementById('tiktokDynamicFee')?.value) || 5.5;
                const platformFeeRate = parseFloat(document.getElementById('tiktokPlatformFee')?.value) || 8.0;
                const processFee = parseFloat(document.getElementById('tiktokProcessFee')?.value) || 1250;
                
                if (method === 'markup') {
                    const profitAmount = totalModalCost * (profit / 100);
                    const targetReceived = totalModalCost + profitAmount;
                    
                    const totalFeeRate = (dynamicFeeRate + platformFeeRate + affiliateFee + komisiKategori + programVoucher + platformAdditionalFee) / 100;
                    const sellingPrice = (targetReceived + processFee) / (1 - totalFeeRate);
                    
                    const dynamicFee = sellingPrice * (dynamicFeeRate / 100);
                    const platformFee = sellingPrice * (platformFeeRate / 100);
                    const biayaProses = processFee;
                    const affiliateCost = sellingPrice * (affiliateFee / 100);
                    const komisiKategoriCost = sellingPrice * (komisiKategori / 100);
                    const programVoucherCost = sellingPrice * (programVoucher / 100);
                    const platformAdditionalCost = sellingPrice * (platformAdditionalFee / 100);
                    const totalFees = dynamicFee + platformFee + biayaProses + affiliateCost + komisiKategoriCost + programVoucherCost + platformAdditionalCost;
                    const netReceived = sellingPrice - totalFees;
                    const actualProfit = netReceived - totalModalCost;
                    
                    results = {
                        platform: 'TikTok Shop',
                        modalPrice,
                        additionalCostAmount,
                        totalModalCost,
                        profitAmount,
                        sellingPrice,
                        dynamicFee,
                        platformFee,
                        biayaProses,
                        affiliateCost,
                        komisiKategoriCost,
                        programVoucherCost,
                        platformAdditionalCost,
                        totalFees,
                        netReceived,
                        actualProfit,
                        fixedFee: 1250,
                        komisiKategori,
                        programVoucher,
                        platformAdditionalFee
                    };
                } else {
                    const totalFeeRate = (dynamicFeeRate + platformFeeRate + affiliateFee + komisiKategori + programVoucher + platformAdditionalFee) / 100;
                    const profitMargin = profit / 100;
                    const sellingPrice = (totalModalCost + processFee) / (1 - totalFeeRate - profitMargin);
                    
                    const dynamicFee = sellingPrice * (dynamicFeeRate / 100);
                    const platformFee = sellingPrice * (platformFeeRate / 100);
                    const biayaProses = processFee;
                    const affiliateCost = sellingPrice * (affiliateFee / 100);
                    const komisiKategoriCost = sellingPrice * (komisiKategori / 100);
                    const programVoucherCost = sellingPrice * (programVoucher / 100);
                    const platformAdditionalCost = sellingPrice * (platformAdditionalFee / 100);
                    const totalFees = dynamicFee + platformFee + biayaProses + affiliateCost + komisiKategoriCost + programVoucherCost + platformAdditionalCost;
                    const netReceived = sellingPrice - totalFees;
                    const actualProfit = netReceived - totalModalCost;
                    
                    results = {
                        platform: 'TikTok Shop',
                        modalPrice,
                        additionalCostAmount,
                        totalModalCost,
                        profitAmount: actualProfit,
                        sellingPrice,
                        dynamicFee,
                        platformFee,
                        biayaProses,
                        affiliateCost,
                        komisiKategoriCost,
                        programVoucherCost,
                        platformAdditionalCost,
                        totalFees,
                        netReceived,
                        actualProfit,
                        fixedFee: 1250,
                        komisiKategori,
                        programVoucher,
                        platformAdditionalFee
                    };
                }
            } else if (platform === 'shopee') {
                // Shopee: affiliate fee ditambah 5% dari input user
                const shopeeAffiliateFee = affiliateFee > 0 ? affiliateFee + 5 : affiliateFee;
                
                if (method === 'markup') {
                    const profitAmount = totalModalCost * (profit / 100);
                    const targetReceived = totalModalCost + profitAmount;
                    
                    const percentageFeeRate = (8 + 7 + shopeeAffiliateFee + platformAdditionalFee) / 100;
                    const sellingPrice = (targetReceived + 1250) / (1 - percentageFeeRate);
                    
                    const biayaLainnya = sellingPrice * 0.08;
                    const biayaLayanan = sellingPrice * 0.07;
                    const biayaProses = 1250;
                    const affiliateCost = sellingPrice * (shopeeAffiliateFee / 100);
                    const platformAdditionalCost = sellingPrice * (platformAdditionalFee / 100);
                    const totalFees = biayaLainnya + biayaLayanan + biayaProses + affiliateCost + platformAdditionalCost;
                    const netReceived = sellingPrice - totalFees;
                    const actualProfit = netReceived - totalModalCost;
                    
                    results = {
                        platform: 'Shopee',
                        modalPrice,
                        additionalCostAmount,
                        totalModalCost,
                        profitAmount,
                        sellingPrice,
                        biayaLainnya,
                        biayaLayanan,
                        biayaProses,
                        affiliateCost,
                        platformAdditionalCost,
                        totalFees,
                        netReceived,
                        actualProfit,
                        fixedFee: 1250,
                        shopeeAffiliateFee: shopeeAffiliateFee,
                        platformAdditionalFee
                    };
                } else {
                    const profitMargin = profit / 100;
                    const percentageFeeRate = (8 + 7 + shopeeAffiliateFee + platformAdditionalFee) / 100;
                    const sellingPrice = (totalModalCost + 1250) / (1 - percentageFeeRate - profitMargin);
                    
                    const biayaLainnya = sellingPrice * 0.08;
                    const biayaLayanan = sellingPrice * 0.07;
                    const biayaProses = 1250;
                    const affiliateCost = sellingPrice * (shopeeAffiliateFee / 100);
                    const platformAdditionalCost = sellingPrice * (platformAdditionalFee / 100);
                    const totalFees = biayaLainnya + biayaLayanan + biayaProses + affiliateCost + platformAdditionalCost;
                    const netReceived = sellingPrice - totalFees;
                    const actualProfit = netReceived - totalModalCost;
                    
                    results = {
                        platform: 'Shopee',
                        modalPrice,
                        additionalCostAmount,
                        totalModalCost,
                        profitAmount: actualProfit,
                        sellingPrice,
                        biayaLainnya,
                        biayaLayanan,
                        biayaProses,
                        affiliateCost,
                        platformAdditionalCost,
                        totalFees,
                        netReceived,
                        actualProfit,
                        fixedFee: 1250,
                        shopeeAffiliateFee: shopeeAffiliateFee,
                        platformAdditionalFee
                    };
                }
            }

            displayResults(results, method);
        }

        function displayResults(results, method) {
            const breakdown = document.getElementById('breakdown');
            const profitOnCost = ((results.actualProfit / results.totalModalCost) * 100).toFixed(1);
            
            let feeBreakdown = '';
            
            if (results.platform === 'TikTok Shop') {
                const dynamicFeeRate = parseFloat(document.getElementById('tiktokDynamicFee')?.value) || 5.5;
                const platformFeeRate = parseFloat(document.getElementById('tiktokPlatformFee')?.value) || 8.0;
                
                feeBreakdown = `
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Dynamic Fee (${dynamicFeeRate}%)</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.dynamicFee)}</span>
                    </div>
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">TikTok Fee (${platformFeeRate}%)</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.platformFee)}</span>
                    </div>
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Biaya Proses Pesanan</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.biayaProses)}</span>
                    </div>
                `;
                
                // Add additional TikTok fees if they exist
                if (results.komisiKategori > 0) {
                    feeBreakdown += `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <span class="text-sm text-gray-600">Komisi Kategori (4%)</span>
                            <span class="font-medium text-gray-900">${formatRupiah(results.komisiKategoriCost)}</span>
                        </div>
                    `;
                }
                
                if (results.programVoucher > 0) {
                    feeBreakdown += `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <span class="text-sm text-gray-600">Program Voucher Extra (4%)</span>
                            <span class="font-medium text-gray-900">${formatRupiah(results.programVoucherCost)}</span>
                        </div>
                    `;
                }
                
                if (results.platformAdditionalFee > 0) {
                    feeBreakdown += `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <span class="text-sm text-gray-600">Biaya Tambahan Platform (${results.platformAdditionalFee}%)</span>
                            <span class="font-medium text-gray-900">${formatRupiah(results.platformAdditionalCost)}</span>
                        </div>
                    `;
                }
            } else if (results.platform === 'Shopee') {
                feeBreakdown = `
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Biaya Lainnya (8%)</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.biayaLainnya)}</span>
                    </div>
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Biaya Layanan (7%)</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.biayaLayanan)}</span>
                    </div>
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Biaya Proses Pesanan</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.biayaProses)}</span>
                    </div>
                `;
                
                if (results.platformAdditionalFee > 0) {
                    feeBreakdown += `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <span class="text-sm text-gray-600">Biaya Tambahan Platform (${results.platformAdditionalFee}%)</span>
                            <span class="font-medium text-gray-900">${formatRupiah(results.platformAdditionalCost)}</span>
                        </div>
                    `;
                }
            }
            
            breakdown.innerHTML = `
                <!-- Input Summary -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Ringkasan Input</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Harga Modal:</span>
                            <span class="font-medium">${formatRupiah(results.modalPrice)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Biaya Tambahan:</span>
                            <span class="font-medium">${formatRupiah(results.additionalCostAmount)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Modal + Biaya:</span>
                            <span class="font-medium">${formatRupiah(results.totalModalCost)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Metode:</span>
                            <span class="font-medium">${method.charAt(0).toUpperCase() + method.slice(1)}</span>
                        </div>
                    </div>
                </div>

                <!-- Selling Price -->
                <div class="bg-primary-50 border border-primary-200 rounded-lg p-6 mb-6">
                    <div class="text-center">
                        <h3 class="text-lg font-semibold text-primary-900 mb-2">Harga Jual Optimal</h3>
                        <div class="text-2xl font-bold text-primary-600">${formatRupiah(results.sellingPrice)}</div>
                        <p class="text-sm text-primary-700 mt-1">${results.platform} • ${method.charAt(0).toUpperCase() + method.slice(1)}</p>
                    </div>
                </div>

                <!-- Cost Breakdown -->
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Breakdown Biaya Modal</h3>
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Harga Modal Dasar</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.modalPrice)}</span>
                    </div>
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Biaya Tambahan (${parseFloat(document.getElementById('additionalCost').value) || 0}%)</span>
                        <span class="font-medium text-gray-900">${formatRupiah(results.additionalCostAmount)}</span>
                    </div>
                    <div class="flex justify-between items-center py-3 bg-gray-50 rounded-lg px-3">
                        <span class="text-sm font-medium text-gray-900">Total Modal + Biaya</span>
                        <span class="font-bold text-gray-900">${formatRupiah(results.totalModalCost)}</span>
                    </div>
                </div>

                <!-- Profit Breakdown -->
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Breakdown Keuntungan</h3>
                    ${method === 'markup' ? `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <span class="text-sm text-gray-600">Target Keuntungan (${parseFloat(document.getElementById('profit').value) || 0}% dari modal)</span>
                            <span class="font-medium text-gray-900">${formatRupiah(results.profitAmount)}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 bg-gray-50 rounded-lg px-3">
                            <span class="text-sm font-medium text-gray-900">Target Yang Diterima</span>
                            <span class="font-bold text-gray-900">${formatRupiah(results.totalModalCost + results.profitAmount)}</span>
                        </div>
                    ` : `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <span class="text-sm text-gray-600">Target Keuntungan (${parseFloat(document.getElementById('profit').value) || 0}% dari harga jual)</span>
                            <span class="font-medium text-gray-900">${formatRupiah(results.sellingPrice * (parseFloat(document.getElementById('profit').value) || 0) / 100)}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 bg-gray-50 rounded-lg px-3">
                            <span class="text-sm font-medium text-gray-900">Target Yang Diterima</span>
                            <span class="font-bold text-gray-900">${formatRupiah(results.sellingPrice * (1 - (parseFloat(document.getElementById('profit').value) || 0) / 100))}</span>
                        </div>
                    `}
                </div>

                <!-- Fee Breakdown -->
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Breakdown Biaya Platform</h3>
                    ${feeBreakdown}
                                         <div class="flex justify-between items-center py-3 border-b border-gray-100">
                         <span class="text-sm text-gray-600">Biaya Affiliate${results.platform === 'Shopee' && results.shopeeAffiliateFee > 0 ? ` (${results.shopeeAffiliateFee}%)` : ''}</span>
                         <span class="font-medium text-gray-900">${formatRupiah(results.affiliateCost)}</span>
                     </div>
                    <div class="flex justify-between items-center py-3 bg-gray-50 rounded-lg px-3">
                        <span class="text-sm font-medium text-gray-900">Total Semua Fee</span>
                        <span class="font-bold text-gray-900">${formatRupiah(results.totalFees)}</span>
                    </div>
                </div>

                <!-- Final Results -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-green-900 mb-3">Hasil Akhir</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-green-700">Yang Diterima (setelah fee)</span>
                            <span class="font-semibold text-green-900">${formatRupiah(results.netReceived)}</span>
                        </div>
                        <div class="flex justify-between items-center pt-3 border-t border-green-200">
                            <span class="text-sm text-green-700">Keuntungan Bersih</span>
                            <span class="font-bold text-green-900">${formatRupiah(results.actualProfit)} (${profitOnCost}% dari modal)</span>
                        </div>
                    </div>
                </div>
            `;

                         document.getElementById('results').classList.remove('hidden');
         }
         
         function addFeeInputListeners() {
             // TikTok fee inputs
             const tiktokDynamicFee = document.getElementById('tiktokDynamicFee');
             const tiktokPlatformFee = document.getElementById('tiktokPlatformFee');
             const tiktokProcessFee = document.getElementById('tiktokProcessFee');
             
             if (tiktokDynamicFee) {
                 tiktokDynamicFee.addEventListener('input', updateTikTokTotalFee);
                 tiktokPlatformFee.addEventListener('input', updateTikTokTotalFee);
                 tiktokProcessFee.addEventListener('input', updateTikTokTotalFee);
             }
             
             // Shopee fee inputs
             const shopeeBiayaLainnya = document.getElementById('shopeeBiayaLainnya');
             const shopeeBiayaLayanan = document.getElementById('shopeeBiayaLayanan');
             const shopeeBiayaProses = document.getElementById('shopeeBiayaProses');
             
             if (shopeeBiayaLainnya) {
                 shopeeBiayaLainnya.addEventListener('input', updateShopeeTotalFee);
                 shopeeBiayaLayanan.addEventListener('input', updateShopeeTotalFee);
                 shopeeBiayaProses.addEventListener('input', updateShopeeTotalFee);
             }
         }
         
         function updateTikTokTotalFee() {
             const dynamicFee = parseFloat(document.getElementById('tiktokDynamicFee')?.value) || 5.5;
             const platformFee = parseFloat(document.getElementById('tiktokPlatformFee')?.value) || 8.0;
             const processFee = parseFloat(document.getElementById('tiktokProcessFee')?.value) || 1250;
             
             const totalFeeElement = document.getElementById('tiktokTotalFee');
             if (totalFeeElement) {
                 totalFeeElement.textContent = `≈ ${(dynamicFee + platformFee).toFixed(1)}% + Rp ${processFee.toLocaleString('id-ID')}`;
             }
         }
         
         function updateShopeeTotalFee() {
             const biayaLainnya = parseFloat(document.getElementById('shopeeBiayaLainnya')?.value) || 8;
             const biayaLayanan = parseFloat(document.getElementById('shopeeBiayaLayanan')?.value) || 7;
             const biayaProses = parseFloat(document.getElementById('shopeeBiayaProses')?.value) || 1250;
             
             const totalFeeElement = document.getElementById('shopeeTotalFee');
             if (totalFeeElement) {
                 totalFeeElement.textContent = `${biayaLainnya + biayaLayanan}% + Rp ${biayaProses.toLocaleString('id-ID')}`;
             }
         }
         
         // Initialize page
         document.addEventListener('DOMContentLoaded', function() {
             // Call updatePlatformFees to set initial state
             updatePlatformFees();
             
             // Register Service Worker for PWA
             if ('serviceWorker' in navigator) {
                 navigator.serviceWorker.register('sw.js')
                     .then(function(registration) {
                         console.log('Service Worker registered successfully:', registration);
                     })
                     .catch(function(error) {
                         console.log('Service Worker registration failed:', error);
                     });
             }
         });
     </script>
 </body>
 </html>
